 name: Build & Test
 on:
   pull_request:
   push:

 jobs:
  base_image_change:
     runs-on: ubuntu-latest
     steps:
       - uses: actions/checkout@v2
         name: checkout source code
       - uses: dorny/paths-filter@v2
         id: changes
         with:
           filters: |
             dockerbasepath:
               - 'Dockerfile_base_image'
  build_mdx_base_image:
    needs: base_image_change
    runs-on: ubuntu-latest
    steps:
       - uses: docker/login-action@v2
         name: docker login
         with:
           registry: ghcr.io
           username: USERNAME
           password: ${{secrets.GITHUB_TOKEN}}
       - uses: actions/checkout@v2
         name: checkout source code
         if: needs.base_image_change.steps.changes.outputs.dockerbasepath
       - uses: docker/build-push-action@v3
         if: needs.base_image_change.steps.changes.outputs.dockerbasepath
         name: Build docker
         with:
            context: Dockerfile_base_image
            tags: mdx:base
            push: true
  build_mdx:
    needs: build_mdx_base_image
    runs-on: ubuntu-latest
    name: Build & Test
    steps:
       - uses: actions/checkout@v2
         name: checkout source code
       - uses: docker/build-push-action@v3
         name: Build docker
         with:
            context: .
            tags: mdx:latest

