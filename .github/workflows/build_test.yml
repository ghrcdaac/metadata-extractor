 name: Build & Test
 on:
   pull_request:
   push:

 jobs:

  build_mdx:
    runs-on: ubuntu-latest
    name: Build & Test
    steps:
       - uses: docker/login-action@v2
         name: docker login
         with:
           registry: ghcr.io
           username: USERNAME
           password: ${{secrets.GITHUB_TOKEN}}
       - uses: actions/checkout@v2
         name: checkout source code

       - uses: dorny/paths-filter@v2
         id: changes
         with:
           filters: |
             dockerbasepath:
               - 'Dockerfile_base_image'
       - name: check variable
         run: |
           echo ${{steps.changes.outputs.dockerbasepath}}
       - uses: docker/build-push-action@v3
         if: steps.changes.outputs.dockerbasepath
         name: Build MDX base docker
         with:
            context: Dockerfile_base_image
            tags: mdx:base
            push: true
       - uses: docker/build-push-action@v3
         name: Build docker
         with:
            context: .
            tags: mdx:latest

