 name: Build & Test
 on:
   pull_request:
   push:

 jobs:
  base_image_change:
     runs-on: ubuntu-latest
     steps:
       - uses: actions/checkout@v2
       - uses: dorny/paths-filter@v2
         id: changes
         with:
           filters: |
             dockerbasepath:
               - 'Dockerfile_base_image'
       - if: steps.changes.outputs.dockerbasepath
        - name: Login to github registrey
          uses: docker/login-action@v2
          with:
            registry: ghcr.io
            username: USERNAME
            password: ${{secrets.GITHUB_TOKEN}}
        - uses: docker/build-push-action@v3
          name: Build docker
          with:
            context: Dockerfile_base_image
            tags: mdx:base
            push: true

  build:
    needs: base_image_change
    runs-on: ubuntu-latest
    name: Build & Test
    steps:
        - uses: actions/checkout@v2
          name: checkout
        - name: Login to github registrey
          uses: docker/login-action@v2
          with:
            registry: ghcr.io
            username: USERNAME
            password: ${{secrets.GITHUB_TOKEN}}
        - uses: docker/build-push-action@v3
          name: Build docker
          with:
            context: .
            tags: mdx:latest

