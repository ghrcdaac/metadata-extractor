FROM public.ecr.aws/lambda/python:3.8

ENV PATH="/root/miniconda3/bin:${PATH}"
ARG PATH="/root/miniconda3/bin:${PATH}"

RUN     yum install wget -y

RUN wget \
    https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh \
    && mkdir /root/.conda \
    && bash Miniconda3-latest-Linux-x86_64.sh -b \
    && rm -f Miniconda3-latest-Linux-x86_64.sh 

RUN conda --version

RUN conda install python=3.8

COPY app.py ${LAMBDA_TASK_ROOT}

RUN yum install -y libxml2

COPY . ${LAMBDA_TASK_ROOT}

RUN     bash conda-requirements.sh && \
        pip3 install -r requirements.txt --target "${LAMBDA_TASK_ROOT}"

# For development
RUN     pip install ipython && \
        pip3 install -r requirements-dev.txt --target "${LAMBDA_TASK_ROOT}"

CMD [ "app.handler" ]